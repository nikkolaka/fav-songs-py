version: '3.8'

services:
  favsongs:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: favsongs-tracker
    image: nikkolaka/favsongs:latest
    env_file:
      - .env
    environment:
      - FAVSONGS_DATA_DIR=/app/data
      - FAVSONGS_DB_PATH=/app/data/favsongs.db
      - FAVORITE_THRESHOLD=5
      - MIN_COMPLETION_RATIO=0.8
      - CHECK_INTERVAL=10
      - MIN_PLAY_GAP_MS=300000
      - PROGRESS_UPDATE_INTERVAL=5
      - PLAYLIST_CACHE_TTL=300
    volumes:
      - favsongs_data:/app/data
    restart: unless-stopped
    init: true
    read_only: true
    tmpfs:
      - /tmp
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL

volumes:
  favsongs_data:
